<!doctype html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>App Launcher - è°ƒè¯•å’Œç¤ºä¾‹</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      line-height: 1.6;
      color: #333;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      text-align: center;
      color: white;
      margin-bottom: 30px;
    }

    .header h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .header p {
      font-size: 1.2rem;
      opacity: 0.9;
    }

    .demo-section {
      background: white;
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .demo-section h2 {
      color: #4a5568;
      margin-bottom: 20px;
      font-size: 1.5rem;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #2d3748;
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 12px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.2s;
    }

    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: #667eea;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .checkbox-group input[type="checkbox"] {
      width: auto;
      margin: 0;
    }

    .btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      margin-right: 10px;
      margin-bottom: 10px;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn-secondary {
      background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
      color: #2d3748;
    }

    .btn-success {
      background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
    }

    .btn-danger {
      background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
    }

    .log-container {
      background: #1a202c;
      color: #e2e8f0;
      padding: 20px;
      border-radius: 8px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 14px;
      max-height: 300px;
      overflow-y: auto;
      margin-top: 20px;
    }

    .log-entry {
      margin-bottom: 8px;
      padding: 4px 0;
    }

    .log-info {
      color: #68d391;
    }

    .log-warn {
      color: #f6e05e;
    }

    .log-error {
      color: #fc8181;
    }

    .device-info {
      background: #f7fafc;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      border-left: 4px solid #667eea;
    }

    .device-info h3 {
      color: #2d3748;
      margin-bottom: 10px;
    }

    .device-info-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
    }

    .device-info-label {
      font-weight: 600;
      color: #4a5568;
    }

    .device-info-value {
      color: #2d3748;
    }

    .result-container {
      background: #f0fff4;
      border: 2px solid #68d391;
      border-radius: 8px;
      padding: 15px;
      margin-top: 20px;
    }

    .result-container.error {
      background: #fff5f5;
      border-color: #fc8181;
    }

    .result-title {
      font-weight: 600;
      margin-bottom: 10px;
    }

    .result-success {
      color: #22543d;
    }

    .result-error {
      color: #742a2a;
    }

    @media (max-width: 768px) {
      .form-row {
        grid-template-columns: 1fr;
      }

      .container {
        padding: 10px;
      }

      .header h1 {
        font-size: 2rem;
      }
    }
  </style>
  <script crossorigin="anonymous" src="http://192.168.41.213:6752/page-spy/index.min.js"></script>
</head>

<body>
  <script>
    $pageSpy = new PageSpy();
  </script>
  <div class="container">
    <div class="header">
      <h1>ğŸš€ App Launcher</h1>
      <p>åº”ç”¨å”¤èµ·åº“è°ƒè¯•å’Œç¤ºä¾‹é¡µé¢</p>
    </div>

    <!-- è®¾å¤‡ä¿¡æ¯æ˜¾ç¤º -->
    <div class="demo-section">
      <h2>ğŸ“± è®¾å¤‡ä¿¡æ¯</h2>
      <div class="device-info" id="deviceInfo">
        <h3>æ£€æµ‹ä¸­...</h3>
      </div>
    </div>

    <!-- åŸºç¡€é…ç½® -->
    <div class="demo-section">
      <h2>âš™ï¸ åŸºç¡€é…ç½®</h2>
      <div class="form-group">
        <label for="scheme">å”¤èµ· Scheme:</label>
        <input type="text" id="scheme" placeholder="myapp://open æˆ– https://myapp.com/open" value="com.laiyouxi.app://">
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="fallbackUrl">å›é€€ URL:</label>
          <input type="text" id="fallbackUrl" placeholder="https://example.com/download"
            value="https://www.laiyouxi.com/landpage/app-guide/download.html">
        </div>
        <div class="form-group">
          <label for="timeout">è¶…æ—¶æ—¶é—´ (ms):</label>
          <input type="number" id="timeout" value="3000" min="1000" max="10000">
        </div>
      </div>

      <div class="form-group">
        <label for="clipboardText">å‰ªåˆ‡æ¿å†…å®¹:</label>
        <textarea id="clipboardText" placeholder="è¦å†™å…¥å‰ªåˆ‡æ¿çš„å†…å®¹ï¼ˆå¯é€‰ï¼‰" rows="3">[æˆ‘æ˜¯è½åœ°é¡µå†™å…¥âœ…]</textarea>
      </div>

      <div class="form-group">
        <div class="checkbox-group">
          <input type="checkbox" id="debug" checked>
          <label for="debug">å¯ç”¨è°ƒè¯•æ¨¡å¼</label>
        </div>
      </div>
    </div>

    <!-- å›è°ƒå‡½æ•°é…ç½® -->
    <div class="demo-section">
      <h2>ğŸ”„ å›è°ƒå‡½æ•°</h2>
      <div class="form-group">
        <label for="onStartCode">onStart å›è°ƒ:</label>
        <textarea id="onStartCode" placeholder="console.log('å¼€å§‹å”¤èµ·åº”ç”¨')" rows="2">console.log('å¼€å§‹å”¤èµ·åº”ç”¨')</textarea>
      </div>

      <div class="form-group">
        <label for="onSuccessCode">onSuccess å›è°ƒ:</label>
        <textarea id="onSuccessCode" placeholder="console.log('åº”ç”¨å”¤èµ·æˆåŠŸ')" rows="2">console.log('åº”ç”¨å”¤èµ·æˆåŠŸ')</textarea>
      </div>

      <div class="form-group">
        <label for="onFailCode">onFail å›è°ƒ:</label>
        <textarea id="onFailCode" placeholder="console.error('åº”ç”¨å”¤èµ·å¤±è´¥:', error)"
          rows="2">console.error('åº”ç”¨å”¤èµ·å¤±è´¥:', error)</textarea>
      </div>
    </div>

    <!-- æ“ä½œæŒ‰é’® -->
    <div class="demo-section">
      <h2>ğŸ® æ“ä½œ</h2>
      <button class="btn" onclick="launchWithBuilder()">ğŸš€ é“¾å¼è°ƒç”¨å”¤èµ·</button>
      <button class="btn btn-secondary" onclick="launchWithConstructor()">ğŸ”§ æ„é€ å‡½æ•°å”¤èµ·</button>
      <button class="btn btn-success" onclick="refreshDeviceInfo()">ğŸ”„ åˆ·æ–°è®¾å¤‡ä¿¡æ¯</button>
      <button class="btn btn-success" onclick="clearLogs()">ğŸ§¹ æ¸…ç©ºæ—¥å¿—</button>
      <button class="btn btn-danger" onclick="testError()">âŒ æµ‹è¯•é”™è¯¯</button>
    </div>

    <!-- æ—¥å¿—è¾“å‡º -->
    <div class="demo-section">
      <h2>ğŸ“ è°ƒè¯•æ—¥å¿—</h2>
      <div class="log-container" id="logContainer">
        <div class="log-entry log-info">ç­‰å¾…æ“ä½œ...</div>
      </div>
    </div>

    <!-- ç»“æœå±•ç¤º -->
    <div class="demo-section">
      <h2>ğŸ“Š æ‰§è¡Œç»“æœ</h2>
      <div id="resultContainer" style="display: none;">
        <!-- ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
      </div>
    </div>
  </div>

  <script type="module">
    import { AppLauncher } from './src'
    import { DeviceDetector } from './src/utils/device'

    // å…¨å±€å˜é‡
    window.AppLauncher = AppLauncher
    window.DeviceDetector = DeviceDetector
    window.logs = []

    // æ—¥å¿—å‡½æ•°
    function log(message, type = 'info') {
      const timestamp = new Date().toLocaleTimeString()
      const logEntry = document.createElement('div')
      logEntry.className = `log-entry log-${type}`
      logEntry.textContent = `[${timestamp}] ${message}`

      const logContainer = document.getElementById('logContainer')
      logContainer.appendChild(logEntry)
      logContainer.scrollTop = logContainer.scrollHeight

      window.logs.push({ timestamp, message, type })
    }

    // æ˜¾ç¤ºè®¾å¤‡ä¿¡æ¯
    function displayDeviceInfo() {
      const deviceInfo = window.deviceInfo
      const container = document.getElementById('deviceInfo')

      container.innerHTML = `
        <h3>è®¾å¤‡æ£€æµ‹ç»“æœ</h3>
        <div class="device-info-item">
          <span class="device-info-label">è®¾å¤‡ç±»å‹:</span>
          <span class="device-info-value">${deviceInfo.isMobile ? 'ç§»åŠ¨è®¾å¤‡' : 'æ¡Œé¢è®¾å¤‡'}</span>
        </div>
        <div class="device-info-item">
          <span class="device-info-label">æ“ä½œç³»ç»Ÿ:</span>
          <span class="device-info-value">
            ${deviceInfo.isAndroid ? 'Android' :
          deviceInfo.isIOS ? 'iOS' :
            deviceInfo.isMacOS ? 'macOS' :
              deviceInfo.isHarmonyOS ? 'é¸¿è’™' : 'å…¶ä»–'}
          </span>
        </div>
        <div class="device-info-item">
          <span class="device-info-label">æµè§ˆå™¨ç¯å¢ƒ:</span>
          <span class="device-info-value">${deviceInfo.isWechat ? 'å¾®ä¿¡å†…ç½®æµè§ˆå™¨' : 'æ™®é€šæµè§ˆå™¨'}</span>
        </div>
        <div class="device-info-item">
          <span class="device-info-label">è®¾å¤‡è¯¦æƒ…:</span>
          <span class="device-info-value">
            ${deviceInfo.isMobile ? 'ğŸ“± ç§»åŠ¨è®¾å¤‡' : 'ğŸ’» æ¡Œé¢è®¾å¤‡'} | 
            ${deviceInfo.isWechat ? 'ğŸ’¬ å¾®ä¿¡ç¯å¢ƒ' : 'ğŸŒ æ™®é€šæµè§ˆå™¨'}
          </span>
        </div>
        <div class="device-info-item">
          <span class="device-info-label">User Agent:</span>
          <span class="device-info-value" style="font-size: 12px; word-break: break-all;">${deviceInfo.rawUA}</span>
        </div>
      `
    }

    // æ˜¾ç¤ºç»“æœ
    function showResult(result) {
      const container = document.getElementById('resultContainer')
      const isSuccess = result.success

      container.innerHTML = `
        <div class="result-container ${isSuccess ? '' : 'error'}">
          <div class="result-title ${isSuccess ? 'result-success' : 'result-error'}">
            ${isSuccess ? 'âœ… å”¤èµ·æˆåŠŸ' : 'âŒ å”¤èµ·å¤±è´¥'}
          </div>
          <div class="device-info-item">
            <span class="device-info-label">æ—¶é—´æˆ³:</span>
            <span class="device-info-value">${new Date(result.timestamp).toLocaleString()}</span>
          </div>
          ${result.error ? `
            <div class="device-info-item">
              <span class="device-info-label">é”™è¯¯ä¿¡æ¯:</span>
              <span class="device-info-value">${result.error.message}</span>
            </div>
          ` : ''}
          <div class="device-info-item">
            <span class="device-info-label">è®¾å¤‡ä¿¡æ¯:</span>
            <span class="device-info-value">${JSON.stringify(result.deviceInfo, null, 2)}</span>
          </div>
        </div>
      `
      container.style.display = 'block'
    }

    // é“¾å¼è°ƒç”¨å”¤èµ·
    window.launchWithBuilder = async function () {
      try {
        log('å¼€å§‹é“¾å¼è°ƒç”¨å”¤èµ·...', 'info')

        const scheme = document.getElementById('scheme').value
        const fallbackUrl = document.getElementById('fallbackUrl').value
        const timeout = parseInt(document.getElementById('timeout').value)
        const clipboardText = getClipboardText()
        console.log("ğŸš€ ~ clipboardText:[builder]", clipboardText)
        const debug = document.getElementById('debug').checked

        const onStartCode = document.getElementById('onStartCode').value
        const onSuccessCode = document.getElementById('onSuccessCode').value
        const onFailCode = document.getElementById('onFailCode').value

        // åˆ›å»ºå›è°ƒå‡½æ•°
        const onStart = onStartCode ? new Function(onStartCode) : undefined
        const onSuccess = onSuccessCode ? new Function(onSuccessCode) : undefined
        const onFail = onFailCode ? new Function('error', onFailCode) : undefined

        log(`é…ç½®å‚æ•°: scheme=${scheme}, fallbackUrl=${fallbackUrl}, timeout=${timeout}ms`, 'info')

        const result = await AppLauncher.create()
          .scheme(scheme)
          .clipboardText(clipboardText)
          .fallbackUrl(fallbackUrl)
          .timeout(timeout)
          .debug(debug)
          .onStart(onStart)
          .onSuccess(onSuccess)
          .onFail(onFail)
          .launch()

        log(`å”¤èµ·å®Œæˆ: ${result.success ? 'æˆåŠŸ' : 'å¤±è´¥'}`, result.success ? 'info' : 'error')
        showResult(result)

      } catch (error) {
        log(`é“¾å¼è°ƒç”¨é”™è¯¯: ${error.message}`, 'error')
        showResult({ success: false, error, timestamp: Date.now(), deviceInfo: window.deviceInfo })
      }
    }

    function getClipboardText() {
      const el = document.getElementById('clipboardText')
      return el.value || el.innerText
    }

    // æ„é€ å‡½æ•°å”¤èµ·
    window.launchWithConstructor = async function () {
      try {
        log('å¼€å§‹æ„é€ å‡½æ•°å”¤èµ·...', 'info')

        const scheme = document.getElementById('scheme').value
        const fallbackUrl = document.getElementById('fallbackUrl').value
        const timeout = parseInt(document.getElementById('timeout').value)
        const clipboardText = getClipboardText()
        console.log("ğŸš€ ~ clipboardText:[constructor]", clipboardText)
        const debug = document.getElementById('debug').checked

        const onStartCode = document.getElementById('onStartCode').value
        const onSuccessCode = document.getElementById('onSuccessCode').value
        const onFailCode = document.getElementById('onFailCode').value

        // åˆ›å»ºå›è°ƒå‡½æ•°
        const onStart = onStartCode ? new Function(onStartCode) : undefined
        const onSuccess = onSuccessCode ? new Function(onSuccessCode) : undefined
        const onFail = onFailCode ? new Function('error', onFailCode) : undefined

        const options = {
          scheme,
          fallbackUrl,
          timeout,
          clipboardText: clipboardText || undefined,
          debug,
          onStart,
          onSuccess,
          onFail
        }

        log(`é…ç½®å‚æ•°: ${JSON.stringify(options, null, 2)}`, 'info')

        const launcher = new AppLauncher(options)
        const result = await launcher.launch()

        log(`å”¤èµ·å®Œæˆ: ${result.success ? 'æˆåŠŸ' : 'å¤±è´¥'}`, result.success ? 'info' : 'error')
        showResult(result)

      } catch (error) {
        log(`æ„é€ å‡½æ•°é”™è¯¯: ${error.message}`, 'error')
        showResult({ success: false, error, timestamp: Date.now(), deviceInfo: window.deviceInfo })
      }
    }

    // æ¸…ç©ºæ—¥å¿—
    window.clearLogs = function () {
      document.getElementById('logContainer').innerHTML = '<div class="log-entry log-info">æ—¥å¿—å·²æ¸…ç©º</div>'
      document.getElementById('resultContainer').style.display = 'none'
      window.logs = []
    }

    // åˆ·æ–°è®¾å¤‡ä¿¡æ¯
    window.refreshDeviceInfo = function () {
      log('é‡æ–°æ£€æµ‹è®¾å¤‡ä¿¡æ¯...', 'info')

      // ä½¿ç”¨çœŸå®çš„è®¾å¤‡æ£€æµ‹
      window.deviceInfo = DeviceDetector.detect()
      log(`è®¾å¤‡æ£€æµ‹ç»“æœ: ${JSON.stringify(window.deviceInfo, null, 2)}`, 'info')

      displayDeviceInfo()
      log('è®¾å¤‡ä¿¡æ¯å·²åˆ·æ–°', 'info')
    }

    // æµ‹è¯•é”™è¯¯
    window.testError = function () {
      log('æµ‹è¯•é”™è¯¯å¤„ç†...', 'warn')
      showResult({
        success: false,
        error: new Error('è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•é”™è¯¯'),
        timestamp: Date.now(),
        deviceInfo: window.deviceInfo
      })
    }

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function () {
      log('é¡µé¢åŠ è½½å®Œæˆï¼Œåˆå§‹åŒ–è®¾å¤‡æ£€æµ‹...', 'info')

      // ä½¿ç”¨çœŸå®çš„è®¾å¤‡æ£€æµ‹
      window.deviceInfo = DeviceDetector.detect()
      log(`è®¾å¤‡æ£€æµ‹ç»“æœ: ${JSON.stringify(window.deviceInfo, null, 2)}`, 'info')

      displayDeviceInfo()
      log('è®¾å¤‡æ£€æµ‹å®Œæˆ', 'info')
    })
  </script>
</body>

</html>